<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
http://camel.apache.org/schema/spring
http://camel.apache.org/schema/spring/camel-spring.xsd">

    <bean id="propertyPlaceholderConfigurer"
          class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:sql.properties</value>
            </list>
        </property>
    </bean>

    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="${jdbc.driverClassName}"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>

   <!-- configure the Camel SQL component to use the JDBC data source -->
   <bean id="sql" class="org.apache.camel.component.sql.SqlComponent">
        <property name="dataSource" ref="dataSource"/>
    </bean>

   <bean id="dbBean" class="com.invessence.broker.dao.DatabaseBean" init-method="initialize" destroy-method="updateDate">
      <property name="dataSource" ref="dataSource"/>
   </bean>

    <bean id="dateFilter" class="com.invessence.broker.filters.DateFilter">
      <property name="databaseBean" ref="dbBean"/>
   </bean>

   <bean id="positionFileFilter" class="com.invessence.broker.filters.PositionFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="accountFileFilter" class="com.invessence.broker.filters.AccountFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="cashReportFileFilter" class="com.invessence.broker.filters.CashReportFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="cashTransactionFileFilter" class="com.invessence.broker.filters.CashTransactionFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="commissionFileFilter" class="com.invessence.broker.filters.CommissionFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="navDailyFileFilter" class="com.invessence.broker.filters.NAVDailyFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="tradeFileFilter" class="com.invessence.broker.filters.TradeFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="unbndldCommissionFileFilter" class="com.invessence.broker.filters.UnbndldCommissionFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="relAndUnrelFileFilter" class="com.invessence.broker.filters.RelAndUnrelFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
   </bean>

   <bean id="summaryFileFilter" class="com.invessence.broker.filters.SummaryFileFilter">
      <property name="dateFilter" ref="dateFilter"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="positionFileProcessor" class="com.invessence.broker.processors.PositionFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="accountFileProcessor" class="com.invessence.broker.processors.AccountFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="cashReportFileProcessor" class="com.invessence.broker.processors.CashReportFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="navDailyFileProcessor" class="com.invessence.broker.processors.NAVDailyFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="commissionFileProcessor" class="com.invessence.broker.processors.CommissionFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="cashTransactionFileProcessor" class="com.invessence.broker.processors.CashTransactionFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="tradeFileProcessor" class="com.invessence.broker.processors.TradeFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="unbndldCommissionFileProcessor" class="com.invessence.broker.processors.UnbndldCommissionFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <bean id="relAndUnrelFileProcessor" class="com.invessence.broker.processors.RelAndUnrealFileProcessor">
      <property name="dataSource" ref="dataSource"/>
      <property name="dao" ref="dbBean"/>
   </bean>

   <camelContext id="camel-context" xmlns="http://camel.apache.org/schema/spring">
      <!-- use Camel property placeholder loaded from the given file -->
      <propertyPlaceholder id="ftpProperties" location="classpath:ftp.properties,classpath:sql.properties"/>

      <!-- Process Position Files-->
      <route id="ftpPositionFilesFromBroker">
         <from uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#positionFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/Positions"/>
         <to uri="direct:processPositionFiles"/>
      </route>
      <route id="processPositionsFiles">
         <from uri="direct:processPositionFiles"/>
         <to uri="bean:positionFileProcessor?method=process"/>
         <to uri="direct:uploadPositionToDB"/>
      </route>
      <route id="insertPositionsToDB">
         <from uri="direct:uploadPositionToDB"/>
          <to uri="sql:{{sql.insertPositions}}?batch=true"/>
      </route>

      <!-- Process Account Information Files-->
      <route id="ftpAccountInformationFilesFromBroker">
         <from uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#accountFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/Accounts"/>
         <to uri="direct:processAccountFile"/>
      </route>
      <route id="processAccountsFile">
         <from uri="direct:processAccountFile"/>
         <to uri="bean:accountFileProcessor?method=process"/>
         <to uri="direct:uploadAccountsToDB"/>
      </route>
       <route id="insertAccountsToDB">
         <from uri="direct:uploadAccountsToDB"/>
          <to uri="sql:{{sql.insertAccounts}}?batch=true"/>
      </route>

      <!-- Process Cash Report Files-->
      <route id="ftpCashReportFilesFromBroker">
         <from uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#cashReportFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/CashReport"/>
         <to uri="direct:processCashReport"/>
      </route>
      <route id="processCashReports">
         <from uri="direct:processCashReport"/>
         <to uri="bean:cashReportFileProcessor?method=process"/>
         <to uri="direct:uploadCashReportToDB"/>
      </route>
       <route id="uploadCashReportsToDB">
         <from uri="direct:uploadCashReportToDB"/>
          <to uri="sql:{{sql.insertCashReports}}?batch=true"/>
      </route>

      <!-- Process NAV Daily Files-->
      <route id="ftpNAVDailyFilesFromBroker">
         <from uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#navDailyFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/NAVDaily"/>
         <to uri="direct:processNAVDailyFiles"/>
      </route>
      <route id="processNAVDailyFiles">
         <from uri="direct:processNAVDailyFiles"/>
         <to uri="bean:navDailyFileProcessor?method=process"/>
         <to uri="direct:uploadNAVToDB"/>
      </route>
      <route id="insertNAVDailyToDB">
         <from uri="direct:uploadNAVToDB"/>
          <to uri="sql:{{sql.insertnavdaily}}?batch=true"/>
      </route>

      <!-- Process Commission Files-->
      <route id="ftpCommissionFilesFromBroker">
         <from uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#commissionFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/Commission"/>
         <to uri="direct:processCommissionFiles"/>
      </route>
      <route id="processCommissionFiles">
         <from uri="direct:processCommissionFiles"/>
         <to uri="bean:commissionFileProcessor?method=process"/>
         <to uri="direct:uploadCommissionToDB"/>
      </route>
      <route id="insertCommissionToDB">
         <from uri="direct:uploadCommissionToDB"/>
          <to uri="sql:{{sql.insertcommission}}?batch=true"/>
      </route>

      <!-- Process Cash Transaction Files-->
      <route id="ftpTransactionFilesFromBroker">
         <from
            uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#cashTransactionFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/CashTransaction"/>
         <to uri="direct:processTransactionFiles"/>
      </route>
      <route id="processTransactionFiles">
         <from uri="direct:processTransactionFiles"/>
         <to uri="bean:cashTransactionFileProcessor?method=process"/>
         <to uri="direct:uploadTransactionToDB"/>
      </route>
      <route id="insertTransactionToDB">
         <from uri="direct:uploadTransactionToDB"/>
          <to uri="sql:{{sql.insertcashtransaction}}?batch=true"/>
      </route>

      <!-- Process Cash Transaction Files-->
      <route id="ftpTradeFilesFromBroker">
         <from
            uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#tradeFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/Trade"/>
         <to uri="direct:processTradeFiles"/>
      </route>
      <route id="processTradeFiles">
         <from uri="direct:processTradeFiles"/>
         <to uri="bean:tradeFileProcessor?method=process"/>
         <to uri="direct:uploadTradeToDB"/>
      </route>
      <route id="insertTradeToDB">
         <from uri="direct:uploadTradeToDB"/>
          <to uri="sql:{{sql.inserttrades}}?batch=true"/>
      </route>

      <route id="ftpUnbndldCommissionFilesFromBroker">
         <from
            uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#unbndldCommissionFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/UnbndldCommission"/>
         <to uri="direct:processUnbndldCommissionFiles"/>
      </route>
      <route id="processUnbndldCommissionFiles">
         <from uri="direct:processUnbndldCommissionFiles"/>
         <to uri="bean:unbndldCommissionFileProcessor?method=process"/>
         <to uri="direct:uploadUnbndldCommissionToDB"/>
      </route>
      <route id="insertUnbndldCommissionToDB">
         <from uri="direct:uploadUnbndldCommissionToDB"/>
          <to uri="sql:{{sql.insertunbndldCommission}}?batch=true"/>
      </route>

      <route id="ftpRelAndUnrelFilesFromBroker">
         <from
            uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#relAndUnrelFileFilter&amp;delay={{ftp.delay}}"/>
         <to uri="file://{{ftp.localdir}}/RelAndUnrel"/>
         <to uri="direct:processRelAndUnrelFiles"/>
      </route>
      <route id="processRelAndUnrelFiles">
         <from uri="direct:processRelAndUnrelFiles"/>
         <to uri="bean:relAndUnrelFileProcessor?method=process"/>
         <to uri="direct:uploadRelAndUnrelToDB"/>
      </route>
      <route id="insertRelAndUnrelToDB">
         <from uri="direct:uploadRelAndUnrelToDB"/>
          <to uri="sql:{{sql.insertrelAndunrel}}?batch=true"/>
      </route>

      <route id="retrieveDailyReports">
         <from uri="sql:{{sql.getdailyreport}}"/>
         <to uri="direct:downloadRpt"/>
      </route>
      <route id="ftpSummaryFilesFromBroker">
         <from uri="direct:downloadRpt"/>
         <from
            uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#dailyFileFilter&amp;recursive=true&amp;delay={{ftp.delay}}"/>
         <to uri="direct:markDB"/>
      </route>
      <route id="addRptToDB">
         <from uri="direct:markDB"/>
         <to uri="bean:dbUpdater?method=process"/>
      </route>

      <route id="retrieveMonthlyReports">
         <from uri="sql:{{sql.getmonthlyreport}}"/>
         <to uri="direct:downloadRpt"/>
      </route>
      <route id="ftpSummaryFilesFromBroker">
         <from uri="direct:downloadRpt"/>
         <from
            uri="ftp://{{ftp.username}}@{{ftp.host}}/Outgoing?password={{ftp.password}}&amp;filter=#monthlyFileFilter&amp;recursive=true&amp;delay={{ftp.delay}}"/>
         <to uri="direct:markDB"/>
      </route>
      <route id="addRptToDB">
         <from uri="direct:markDB"/>
         <to uri="bean:dbUpdater?method=process"/>
      </route>

   </camelContext>
</beans>