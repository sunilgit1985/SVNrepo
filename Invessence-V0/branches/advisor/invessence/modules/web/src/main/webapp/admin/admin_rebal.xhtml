<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>

    <ui:composition template="/template/common/adminLayout.xhtml">

        <ui:define name="content">
            <h:form id="tradeForm">
                 <p:tabView effect="clip" effectDuration="normal" cache="true" dynamic="true">
                     <p:tab title="View Accounts">
                         <p:panelGrid id="rebalgrid2" styleClass="invNBgrid">
                             <p:row>
                                 <p:column colspan="5">
                                     <p:messages autoUpdate="true" closable="true"/>
                                 </p:column>
                             </p:row>
                             <p:row>
                                 <p:column colspan="5">
                                     <p:commandButton value="Reload"
                                                      process="@form" update="dataGrid"
                                                      actionListener="#{adminbean.redoRebalance}"/>
                                 </p:column>
                             </p:row>
                             <p:row>
                                 <p:column>
                                     <h:outputText value="Hide: " />
                                 </p:column>
                                 <p:column colspan="6">
                                     <p:selectManyCheckbox id="lineDirection" value="#{adminbean.filteredOption}">
                                         <f:selectItem itemLabel="View" itemValue="V" />
                                         <f:selectItem itemLabel="Date" itemValue="D" />
                                         <f:selectItem itemLabel="Offset" itemValue="O" />
                                         <f:selectItem itemLabel="New" itemValue="N" />
                                     </p:selectManyCheckbox>
                                 </p:column>
                                 <p:column>
                                     <p:commandButton value="Refresh"
                                                      process="@form" update="dataGrid"
                                                      actionListener="#{adminbean.refreshTradeClient}"/>
                                 </p:column>

                             </p:row>
                             </p:panelGrid>
                         <p:panelGrid id="dataGrid">
                             <p:row>
                                 <p:column colspan="10">
                                 <p:dataTable id="tradeList" var="filteredData" value="#{adminbean.filteredTradeList}"
                                              paginator="true" rows="10" border="1" styleClass="invAdminTable"
                                              rowKey="#{filteredData.acctnum}" rowIndexVar="rowIndex"
                                              selection="#{adminbean.selectedTradeAccounts}">
                                     <f:facet name="header" style="text-align: left;">
                                         Choose Account to include in trade.
                                     </f:facet>

                                     <p:column selectionMode="multiple" style="width:2%" />

                                     <p:column headerText="InvAcc#" style="width:5%">
                                         #{filteredData.acctnum}
                                     </p:column>

                                     <p:column headerText="IBAcct#" style="width:10%">
                                         #{filteredData.clientAccountID}
                                     </p:column>

                                     <p:column headerText="Name" style="width:30%">
                                         #{filteredData.name}
                                     </p:column>

                                     <p:column headerText="Type" style="width:15%">
                                         #{filteredData.accountType}
                                     </p:column>

                                     <p:column headerText="Reason" style="width:10%; text-align: left">
                                         #{filteredData.reason}
                                     </p:column>

                                        <p:column headerText="Last Traded" style="width:10%; text-align: right">
                                         #{filteredData.lastTraded}
                                     </p:column>

                                     <p:column headerText="AA Offset" style="width:10%; text-align: right">
                                         #{dataDisplayConverter.displayAsPercent(filteredData.assetAllocationOffset)}
                                     </p:column>

                                     <p:column headerText="Investment($)" style="width:15%; text-align: right">
                                         <h:outputText value="#{dataDisplayConverter.displayAsMoney(filteredData.actualInvestment)}">
                                         </h:outputText>
                                     </p:column>

                                     <p:column headerText="KeepLiquid" style="width:5%; text-align: right">
                                         #{dataDisplayConverter.displayAsMoney(filteredData.keepLiquid)}
                                     </p:column>
                                     <p:column headerText="Position" style="width:15%; text-align: right">
                                         <h:outputText value="#{filteredData.position}">
                                             <f:convertNumber pattern="###,###,###"/>
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="Asset" style="width:15%; text-align: right">
                                         <h:outputText value="#{filteredData.assetClass}">
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="CurrentAlloc" style="width:5%; text-align: right">

                                         <h:outputText value="#{dataDisplayConverter.displayAsPercent(filteredData.currentAllocation)}">
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="RequiredAlloc" style="width:5%; text-align: right">
                                         <h:outputText value="#{filteredData.requiredAllocation}">
                                             <f:convertNumber pattern="##0.00"/>
                                         </h:outputText>
                                     </p:column>

<!--
                                     <p:column style="width:5%">
                                         <p:commandButton id="selectButton" process="@this"
                                                          value="View" icon="ui-icon-zoomin"
                                                          actionListener="#{adminbean.viewTradeClient}"
                                                          oncomplete="PF('singlePosition').show()">
                                             <f:setPropertyActionListener value="#{filteredData}"
                                                                          target="#{adminbean.singleTradeAccount}"/>
                                         </p:commandButton>
                                     </p:column>
-->

                                     <f:facet name="footer">
                                         <p:commandButton id="tradeButton" value="Create Trades"
                                                          update="@this" process="@form" ajax="true"
                                                          actionListener="#{adminbean.createTrades}"/>
                                     </f:facet>
                                 </p:dataTable>
                                 </p:column>

                             </p:row>
                         </p:panelGrid>
                     </p:tab>
                     <p:tab title="Validate">
                         <p:panelGrid id="validategrid2" styleClass="invNBgrid">
                         <p:row>
                             <p:column colspan="5">
                                 <p:messages autoUpdate="true" closable="true"/>
                             </p:column>
                         </p:row>
                         <p:row>
                             <p:column colspan="5">
                                 <p:commandButton value="Validate Trades"
                                                  process="@form" update="tradeBrowser"
                                                  actionListener="#{adminbean.displayTrades}"/>
                             </p:column>
                         </p:row>
                     </p:panelGrid>
                         <p:panelGrid id="tradeBrowser">
                         <p:row>
                                 <p:column colspan="12">
                                     <p:dataTable id="tradeTable" var="trade" value="#{adminbean.tradedetails}"
                                                  border="2" styleClass="invAdminTable">
                                         <p:column
                                                 style="width:5px; text-align: right;"
                                                 headerText="" resizable="true">
                                             <h:outputText value="#{trade.sortOrder}"/>
                                         </p:column>
                                         <p:column
                                                   style="width:40px; text-align: left;"
                                                   headerText="Asset Type" resizable="true">
                                             <h:outputText value="#{trade.assetclass}"/>
                                         </p:column>
                                         <p:column headerText="Acct#"
                                                   style="width:30px; text-align: left" resizable="true">
                                             <h:outputText value="#{trade.acctnum}">
                                            </h:outputText>
                                         </p:column>
                                         <p:column headerText="IB#"
                                                   style="width:30px; text-align: left" resizable="true">
                                             <h:outputText value="#{trade.clientAccountID}"/>
                                         </p:column>
                                         <p:column headerText="Name"
                                                   style="width:100px; text-align: left" resizable="true">
                                             <h:outputText value="#{trade.name}"/>
                                         </p:column>
                                         <p:column headerText="Type"
                                                   style="width:100px; text-align: left" resizable="true">
                                             <h:outputText value="#{trade.accttype}"/>
                                         </p:column>
                                         <p:column headerText="Ticker"
                                                   style="width:30px; text-align: left" resizable="true">
                                             <h:outputText value="#{trade.ticker}"/>
                                         </p:column>
                                         <p:column headerText="B/S"
                                                   style="width:30px; text-align: left" resizable="true">
                                             <h:outputText value="#{trade.tradedirection}"/>
                                         </p:column>
                                         <p:column headerText="Final(#)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.adjustedqty}">
                                                 <f:convertNumber pattern="###,###,###"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Price($)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.tradeprice}">
                                                 <f:convertNumber pattern="###,##0.00"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Final($)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.tradeamount}">
                                                 <f:convertNumber pattern="###,###,##0.00"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Cash Bal.($)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.runningCash}">
                                                 <f:convertNumber pattern="###,###,##0.00"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Current (#)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.posqty}">
                                                 <f:convertNumber pattern="###,###"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Expected (#)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.tradeqty}">
                                                 <f:convertNumber pattern="###,###"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="PnL($)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.pnl}">
                                                 <f:convertNumber pattern="###,###,##0.00"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Gain/Loss($)"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.gainloss}">
                                                 <f:convertNumber pattern="###,###,##0.00"/>
                                             </h:outputText>
                                         </p:column>
                                         <p:column headerText="Price/Share"
                                                   style="width:90px; text-align: right"
                                                   resizable="true">
                                             <h:outputText value="#{trade.pricePerShare}">
                                                 <f:convertNumber pattern="##0.00000"/>
                                             </h:outputText>
                                         </p:column>

                                         <p:columnGroup type="footer">
                                             <p:row>
                                                 #=Shares, $=Value(Money)
                                             </p:row>
                                         </p:columnGroup>
                                     </p:dataTable>
                                 </p:column>
                             </p:row>
                         </p:panelGrid>
                     </p:tab>
                     <p:tab title="Download">
                         <p:panelGrid id="rebalgrid3" styleClass="invNBgrid">
                             <p:row>
                                 <p:column colspan="5">
                                     <p:messages autoUpdate="true" closable="true"/>
                                 </p:column>
                             </p:row>
                         <p:row>
                             <p:column colspan="5">
                                 <p:commandButton type="submit" value="Generate Trades"
                                                  action="#{adminbean.generateTrades}"/>
                             </p:column>
                         </p:row>
                             <p:row>
                                 <p:column>
                                     <p:commandButton id="downloadTrade1" value="Download Trade (Buy)" ajax="false"
                                                      onclick="PrimeFaces.monitorDownload(start, stop)"
                                                      icon="ui-icon-arrowthichk-s">
                                         <p:fileDownload value="#{adminbean.trade1}" />
                                     </p:commandButton>
                                     <p:commandButton id="downloadTrade2" value="Download Trade (Sell)" ajax="false"
                                                      onclick="PrimeFaces.monitorDownload(start, stop)"
                                                      icon="ui-icon-arrowthichk-s">
                                         <p:fileDownload value="#{adminbean.trade2}" />
                                     </p:commandButton>
                                 </p:column>
                             </p:row>
                             <p:row>
                                 <p:column>
                                     <p:commandButton id="downloadAlloc1" value="Download Alloc (Buy)" ajax="false"
                                                      onclick="PrimeFaces.monitorDownload(start, stop)"
                                                      icon="ui-icon-arrowthichk-s">
                                         <p:fileDownload value="#{adminbean.alloc1}" />
                                     </p:commandButton>
                                     <p:commandButton id="downloadAlloc2" value="Download Alloc (Sell)" ajax="false"
                                                      onclick="PrimeFaces.monitorDownload(start, stop)"
                                                      icon="ui-icon-arrowthichk-s">
                                         <p:fileDownload value="#{adminbean.alloc2}" />
                                     </p:commandButton>
                                 </p:column>
                             </p:row>
                         </p:panelGrid>

                    </p:tab>
                     <p:tab title="Options">
                         <p:panelGrid id="rebalgrid" styleClass="invNBgrid">
                             <p:row>
                                 <p:column colspan="5">
                                     <p:messages autoUpdate="true" closable="true"/>
                                 </p:column>
                             </p:row>
                             <p:row>
                                 <p:column>
                                     <p:outputLabel value="Next Balance Date"/>
                                 </p:column>
                                 <p:column>
                                     <p:inputMask value="#{adminbean.nextRebalDate}" mask="99/99/9999"/>
                                 </p:column>
                                 <p:column>
                                     <p:outputLabel value="(mm/dd/yyyy)"/>
                                 </p:column>
                                 <p:column>
                                     <p:commandButton type="submit" value="Save"
                                                      action="#{adminbean.saveNextRebalDate}"/>
                                 </p:column>
                             </p:row>
                         </p:panelGrid>

                     </p:tab>
                 </p:tabView>
            </h:form>

                 <p:dialog id="viewTrades" header="Portfolio" widgetVar="singlePosition" resizable="false"
                           showEffect="fade" hideEffect="explode">

                     <p:panelGrid id="dataGrid" styleClass="invNBgrid">
                         <p:row>
                             <p:column>
                                 <p:outputLabel value="IB#"/>
                             </p:column>
                             <p:column>
                                 <p:outputLabel value="#{adminbean.clientAccountID}"/>
                             </p:column>
                             <p:column>
                                 <p:outputLabel value="Inv#"/>
                             </p:column>
                             <p:column>
                                 <p:outputLabel value="#{adminbean.acctnum}"/>
                             </p:column>
                             <p:column>
                                 <p:outputLabel value="Name"/>
                             </p:column>
                             <p:column>
                                 <p:outputLabel value="#{adminbean.name}"/>
                             </p:column>
                         </p:row>
                         <p:row>
                             <p:column colspan="10">
                                 <p:dataTable id="dataTable" var="posdata" value="#{adminbean.positionList}"
                                              styleClass="invDataTable">
                                     <p:column
                                               style="width:100px; text-align: left;"
                                               headerText="Asset Type" resizable="true">
                                         <h:outputText value="#{posdata.assetclass}"/>
                                     </p:column>
                                     <p:column headerText="Sub Asset Type"
                                               style="width:130px; text-align: left"
                                               resizable="true">
                                         <h:outputText value="#{posdata.subclass}"/>
                                     </p:column>
                                     <p:column headerText="Weight"
                                               style="width:30px; text-align: right" resizable="true">
                                         <h:outputText value="#{adminbean.getAllocatedPortfolioWeight(posdata.invested)}">
                                             <f:convertNumber pattern="###.##"/>
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="Ticker"
                                               style="width:90px; text-align: left" resizable="true">
                                         <h:outputText value="#{posdata.ticker}"/>
                                     </p:column>
                                     <p:column headerText="Name"
                                               style="width:200px; text-align: left" resizable="true">
                                         <h:outputText value="#{posdata.name}"/>
                                     </p:column>
                                     <p:column headerText="Orig Price($)"
                                               style="width:90px; text-align: right"
                                               resizable="true">
                                         <h:outputText value="#{posdata.origPrice}">
                                             <f:convertNumber minFractionDigits="2"/>
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="Orig Value($)"
                                               style="width:90px; text-align: right"
                                               resizable="true">
                                         <h:outputText value="#{posdata.origInvested}">
                                             <f:convertNumber minFractionDigits="2"/>
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="Price($)"
                                               style="width:90px; text-align: right"
                                               resizable="true">
                                         <h:outputText value="#{posdata.price}">
                                             <f:convertNumber minFractionDigits="2"/>
                                         </h:outputText>
                                     </p:column>
                                     <p:column headerText="New Value($)"
                                               style="width:90px; text-align: right"
                                               resizable="true">
                                         <h:outputText value="#{posdata.invested}">
                                             <f:convertNumber minFractionDigits="2"/>
                                         </h:outputText>
                                     </p:column>

                                     <p:columnGroup type="footer">
                                         <p:row>
                                             <p:column colspan="5" footerText="Total" style="text-align:left"/>

                                             <p:column footerText="#{adminbean.populatetotalvalue}" colspan="2" style="text-align:right"/>
                                             <p:column footerText="#{adminbean.populatetotalvalue2}" colspan="2" style="text-align:right"/>
                                         </p:row>
                                     </p:columnGroup>
                                 </p:dataTable>
                             </p:column>
                         </p:row>
                     </p:panelGrid>
                 </p:dialog>


      </ui:define>

    </ui:composition>

</h:body>

</html>